{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ResearchMate — Admin Dashboard</title>
  <link rel="stylesheet" href="{% static 'ConsultApp/dashboard.css' %}">
</head>
<body>
  <div class="dashboard-container">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <div class="logo">
        <img src="{% static 'ConsultApp/images/ResearchMate-logo-title.png' %}" alt="ResearchMate">
      </div>

      <ul class="menu">
        <li class="active"><a href="{% url 'admin_dashboard' %}">🏠 Dashboard</a></li>
        <li><a href="{% url 'admin_students' %}">👥 Manage Students</a></li>
        <li><a href="{% url 'admin_consultants' %}">👩‍🏫 Manage Consultants</a></li>
        <li><a href="{% url 'admin_reports' %}">📊 Reports</a></li>
        <li><a href="{% url 'admin_profile' %}">👤 Profile Management</a></li>
      </ul>

      <form method="POST" action="{% url 'logout' %}">
        {% csrf_token %}
        <button class="logout-btn">Logout</button>
      </form>
    </aside>

    <!-- ===== Main content column ===== -->
    <main class="content-wrap">
      <!-- Top hero section -->
      <div class="hero">
        <div class="left">
          <span class="date">📅 {{ current_date }}</span>
          <h1>Welcome back, <span id="adminNameDisplay">{{ admin_name }}</span>!</h1>
          <p>Monitor the platform and manage users</p>
        </div>
        <div class="brand">ResearchMate</div>
      </div>

      <!-- Main grid below hero -->
      <div class="main-grid">
        <section>
          <div class="card overview-card">
            <h2>📊 System Overview</h2>
            <div class="stats-grid">
              <div class="stat">
                <h4>Total Students</h4>
                <div class="num">{{ total_students }}</div>
              </div>
              <div class="stat">
                <h4>Total Consultants</h4>
                <div class="num">{{ total_consultants }}</div>
              </div>
              <div class="stat">
                <h4>Active Bookings</h4>
                <div class="num">{{ active_bookings }}</div>
              </div>
            </div>
          </div>

          <div class="card consultants-section">
            <h2>📝 Consultant Verification Requests</h2>
            <div id="verificationRequests">
              {% if verification_requests %}
                {% for req in verification_requests %}
                  <div class="rem-item">
                    <p><strong>{{ req.full_name }}</strong> — {{ req.expertise }}</p>
                    <p>📧 {{ req.contact }}</p>
                    <small>Qualification: {{ req.qualification }}</small>
                    <form method="POST" action="{% url 'approve_consultant' req.id %}" style="display:inline;">
                      {% csrf_token %}
                      <button class="btn-primary" type="submit">Approve</button>
                    </form>
                    <form method="POST" action="{% url 'reject_consultant' req.id %}" style="display:inline;">
                      {% csrf_token %}
                      <button type="submit" style="margin-left:8px;">Reject</button>
                    </form>
                  </div>
                {% endfor %}
              {% else %}
                <p>No pending requests</p>
              {% endif %}
            </div>
          </div>
        </section>

        <!-- Right Column -->
        <aside class="right-column">
          <div class="card profile-card">
            <div class="profile-top">
              <img src="{% static 'ConsultApp/images/admin.png' %}" alt="admin" class="profile-pic">
              <div class="info">
                <p><strong>{{ admin_name }}</strong></p>
                <p style="color:#777">{{ admin_role }}</p>
              </div>
            </div>
            <p><strong>Email:</strong> {{ admin_email }}</p>
            <p><strong>Contact:</strong> {{ admin_contact }}</p>
            <div style="margin-top:12px;">
              <a href="{% url 'admin_profile' %}" class="btn-primary" style="display:block;text-align:center;">Edit Info</a>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>
  
{% comment %} <script>
  function goToProfile(){ window.location.href = 'admin-profile-management.html'; }

  // Sidebar navigation
  document.querySelectorAll('.menu li').forEach(item => {
    item.addEventListener('click', () => {
      const link = item.getAttribute('data-link');
      if(link) window.location.href = link;
    });
  });

  // Logout
  document.querySelectorAll('.logout-btn').forEach(btn => {
    btn.addEventListener('click', () => window.location.href='login-register.html');
  });

  // Display admin info from localStorage
  const name = localStorage.getItem('adminName') || 'Admin User';
  const email = localStorage.getItem('adminEmail') || 'admin@cit.edu';
  const contact = localStorage.getItem('adminContact') || 'N/A';
  document.getElementById('adminNameDisplay').textContent = name;
  document.getElementById('adminNameSidebar').textContent = name;
  document.getElementById('adminEmailSidebar').textContent = email;
  document.getElementById('adminContactSidebar').textContent = contact;

  // Display verification requests
  const container = document.getElementById("verificationRequests");
  const requests = JSON.parse(localStorage.getItem("verificationRequests")) || [];
  if (requests.length > 0) {
    container.innerHTML = "";
    requests.forEach((req, index) => {
      const div = document.createElement("div");
      div.classList.add("rem-item");
      div.innerHTML = `
        <p><strong>${req.fullName}</strong> — ${req.expertise}</p>
        <p>📧 ${req.contact}</p>
        <small>Qualification: ${req.qualification}</small>
        <br>
        <button onclick="approve(${index})" class="btn-primary">Approve</button>
        <button onclick="reject(${index})" style="margin-left:8px;">Reject</button>
      `;
      container.appendChild(div);
    });
  }

  function approve(i){
    let reqs = JSON.parse(localStorage.getItem("verificationRequests")) || [];
    let consultant = reqs[i];
    localStorage.setItem("verifiedConsultant", JSON.stringify(consultant));
    reqs.splice(i,1);
    localStorage.setItem("verificationRequests", JSON.stringify(reqs));
    alert("Consultant verified!");
    location.reload();
  }

  function reject(i){
    let reqs = JSON.parse(localStorage.getItem("verificationRequests")) || [];
    reqs.splice(i,1);
    localStorage.setItem("verificationRequests", JSON.stringify(reqs));
    alert("Request rejected.");
    location.reload();
  }
</script> {% endcomment %}
</body>
</html>
